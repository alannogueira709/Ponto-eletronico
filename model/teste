from usuario import Usuario
import cv2
import face_recognition as fr
import numpy as np


def reconhece_face(url_foto):
    foto = fr.load_image_file(url_foto)
    rostos = fr.face_encodings(foto)
    print(rostos)
    if len(rostos) > 0:
        return True, rostos
    
    return False, []

def get_rostos():
    
    rostos_conhecidos = []
    nomes_rostos = []

    adriano = reconhece_face("adriano.jpeg")

        
    if adriano[0]:
        rostos_conhecidos.append(adriano[1][0])
        nomes_rostos.append("adriano")
    
    return rostos_conhecidos, nomes_rostos




rostos_conhecidos, nome_rostos = get_rostos()

video_capture = cv2.VideoCapture(0)

while True:
    ret, frame = video_capture.read()
    rgb_frame = frame[:, :, ::-1]
    
    localizacao_rostos = fr.face_locations(frame)
    rostos_desconhecidos = fr.face_encodings(frame, localizacao_rostos)
    
    for (top, right, bottom, left), rosto_desconhecido in zip(localizacao_rostos, rostos_desconhecidos):
            resultados = fr.compare_faces(rostos_conhecidos, rosto_desconhecido)
            
            face_distances = fr.face_distance(rostos_conhecidos, rosto_desconhecido)
            
            maior_id = np.argmin(face_distances)
            
            if resultados[maior_id]:
                nome = nome_rostos[maior_id]
            else:
                nome = "desconhecido"
                
            cv2.rectangle(frame, (left, top), (right, bottom), (0, 0, 255), 2)
            cv2.putText(frame, nome, (left +6, bottom - 6),cv2.FONT_HERSHEY_COMPLEX, 1.0, (255,255,255), 1)
            
    cv2.imshow("reconhecimento facial", frame)
    
    if cv2.waitKey(1) & 0XFF == ord("q"):
        break
    
    
video_capture.release()
cv2.destroyAllWindows()
